<?php
/*------------------------------------------------------------------------# mod_rizvn_support - Module RizVN Support# ------------------------------------------------------------------------# Author: Phuoc Nguyen# copyright Copyright (C) 2011 RizVN.Net. All Rights Reserved.# @license - http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL# Websites: http://www.rizvn.net# Technical Support: Mail - rizvn93@gmail.com-------------------------------------------------------------------------*/// no direct access
defined('_JEXEC') or die;

class modRizLoginHelper{	static function getReturnURL($params, $type)	{		$app	= JFactory::getApplication();		$router = $app->getRouter();		$url = null;		if ($itemid =  $params->get($type))		{			$db		= JFactory::getDbo();			$query	= $db->getQuery(true);			$query->select($db->nameQuote('link'));			$query->from($db->nameQuote('#__menu'));			$query->where($db->nameQuote('published') . '=1');			$query->where($db->nameQuote('id') . '=' . $db->quote($itemid));			$db->setQuery($query);			if ($link = $db->loadResult()) {				if ($router->getMode() == JROUTER_MODE_SEF) {					$url = 'index.php?Itemid='.$itemid;				}				else {					$url = $link.'&Itemid='.$itemid;				}			}		}		if (!$url)		{			// stay on the same page			$uri = JFactory::getURI();			$vars = $router->parse($uri);			unset($vars['lang']);			if ($router->getMode() == JROUTER_MODE_SEF)			{				if (isset($vars['Itemid']))				{					$itemid = $vars['Itemid'];					$menu = $app->getMenu();					$item = $menu->getItem($itemid);					unset($vars['Itemid']);					if (isset($item) && $vars == $item->query) {						$url = 'index.php?Itemid='.$itemid;					}					else {						$url = 'index.php?'.JURI::buildQuery($vars).'&Itemid='.$itemid;					}				}				else				{					$url = 'index.php?'.JURI::buildQuery($vars);				}			}			else			{				$url = 'index.php?'.JURI::buildQuery($vars);			}		}		return base64_encode($url);	}		static function getType()	{		$user = JFactory::getUser();		return (!$user->get('guest')) ? 'logout' : 'login';	}}